lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/10)
betas <- matrix(rep(0, length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
expect_equal(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)}
)
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:312]/365
d = pbc$status[1:312]
mat = pbc[1:312, c(4, 7, 8)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/10)
betas <- matrix(rep(0, length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
expect_equal(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)}
)
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:312]/365
d = pbc$status[1:312]
mat = pbc[1:312, c(4, 7, 8)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/10)
betas <- matrix(rep(0, length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
expect_equal(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)}
)
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:312]/365
d = pbc$status[1:312]
mat = pbc[1:312, c(4, 7, 8)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/10)
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
expect_equal(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)})
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:312]/365
d = pbc$status[1:312]
mat = pbc[1:312, c(4, 7, 8)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/10)
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
expect_equal(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)})
a = compute_S0(as.matrix(risk.s), t, length(t), length(lms))
b=apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]
as.integer(dimnames(a)[[1]]) - as.integer(dimnames(b)[[1]])
as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms)))
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:312]/365
d = pbc$status[1:312]
mat = pbc[1:312, c(4, 7, 8)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/10)
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
tmp = risk.s
expect_equal(as.matrix(compute_S0(tmp, t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)})
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms)))
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:312]/365
d = pbc$status[1:312]
mat = pbc[1:312, c(4, 7, 8)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/10)
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
tmp = risk.s
expect_equal(as.matrix(compute_S0(tmp, t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)})
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms)))
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])
betas <- matrix(rnorm(length(lms)*dim(mat)[2]/100), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms)))
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms)))
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])
as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms)))
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])
as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms)))
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:312]/365
d = pbc$status[1:312]
mat = pbc[1:312, c(4, 7, 8)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/10)
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
tmp = risk.s
expect_equal(as.matrix(compute_S0(tmp, t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)})
as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])
sum(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
sum(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
(as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]))
mean((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:312]/365
d = pbc$status[1:312]
mat = pbc[1:312, c(4, 7)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/10)
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
tmp = risk.s
expect_equal(as.matrix(compute_S0(tmp, t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)})
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/3)
lms
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
tmp = risk.s
expect_equal(as.matrix(compute_S0(tmp, t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)})
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
apply(diff, 1, mean(abs(x)))
apply(diff, 1, function(x)mean(abs(x)))
sum(apply(diff, 1, function(x)mean(abs(x))))
mean(apply(diff, 1, function(x)mean(abs(x))))
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:100]/365
d = pbc$status[1:100]
mat = pbc[1:100, c(4, 7)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/3)
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
tmp = risk.s
expect_equal(as.matrix(compute_S0(tmp, t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)})
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
t = pbc$time[1:100]/365
d = pbc$status[1:100]
mat = pbc[1:100, c(4, 7)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)]
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/3)
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
tmp = risk.s
e
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
test_that("Compute S0",
{
library(survival)
data("pbc")
t = pbc$time[1:100]/365
d = pbc$status[1:100]
mat = pbc[1:100, c(4, 7)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)] + rnorm(length(t), sd = 0.01)
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/3)
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
tmp = risk.s
expect_equal(as.matrix(compute_S0(tmp, t, length(t), length(lms))),
as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ]),
check.attributes=FALSE)})
t = pbc$time[1:100]/365
d = pbc$status[1:100]
mat = pbc[1:100, c(4, 7)]
d <- d[order(t)]
mat <- as.matrix(mat[order(t), ])
t <- t[order(t)] + rnorm(length(t), sd = 0.01)
lms <- seq(0, round(0.75*max(t)), round(0.75*max(t))/3)
betas <- matrix(seq(1, length(lms)*dim(mat)[2], 1), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
tmp = risk.s
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
betas <- matrix(rnorm(length(lms)*dim(mat)[2]), ncol=dim(mat)[2])
risk.s <- exp(mat %*% t(betas))
diff <- ((as.matrix(compute_S0(as.matrix(risk.s), t, length(t), length(lms))) - as.matrix(apply(risk.s[order(-t), ], 2, cumsum)[order(-(1:length(t))), ])))
mean(apply(diff, 1, function(x)mean(abs(x))))
